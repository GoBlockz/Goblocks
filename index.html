<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>GOblocks | Pro Edition</title>
    <link href="https://fonts.googleapis.com" rel="stylesheet">
    <style>
        :root { --goblocks-red: #e11d48; --dark-bg: #0b0f1a; --sidebar-bg: #161b2d; --card-bg: #1e293b; --accent-gold: #fbbf24; }
        * { margin: 0; padding: 0; box-sizing: border-box; font-family: 'Montserrat', sans-serif; }
        body { background: var(--dark-bg); color: #fff; overflow: hidden; height: 100vh; perspective: 1200px; }

        /* --- 3D CHARACTER ENGINE --- */
        .stage-3d { width: 250px; height: 350px; margin: 20px auto; position: relative; transform-style: preserve-3d; transform: rotateY(-25deg); transition: 0.5s; }
        .stage-3d:hover { transform: rotateY(25deg); }
        .cube { position: absolute; transform-style: preserve-3d; background: var(--char-color, #fbbf24); border: 1px solid rgba(0,0,0,0.2); box-shadow: inset -5px -5px 15px rgba(0,0,0,0.3); }
        
        /* 3D Parts */
        .head { width: 50px; height: 50px; left: 100px; top: 0; }
        .fedora { position: absolute; top: -15px; left: -10px; width: 70px; z-index: 10; }
        .fedora-brim { position: absolute; width: 100px; height: 100px; background: #222; top: 5px; left: -25px; transform: rotateX(90deg); border-radius: 5px; }
        .fedora-top { position: absolute; width: 50px; height: 35px; background: #222; top: -30px; left: 0; border-bottom: 4px solid #e11d48; }
        .torso { width: 90px; height: 110px; left: 80px; top: 55px; }
        .arm { width: 35px; height: 100px; top: 55px; }
        .arm-l { left: 40px; transform: rotateZ(5deg); }
        .arm-r { left: 175px; transform: rotateZ(-5deg); }
        .leg { width: 40px; height: 105px; top: 170px; }
        .leg-l { left: 80px; }
        .leg-r { left: 130px; }

        /* --- UI COMPONENTS --- */
        #top-hud { position: fixed; top: 25px; right: 25px; z-index: 1000; display: none; }
        .stat-pill { background: rgba(22, 27, 45, 0.9); padding: 12px 25px; border-radius: 12px; border: 2px solid var(--goblocks-red); display: flex; align-items: center; gap: 15px; }
        nav.sidebar { width: 280px; background: var(--sidebar-bg); display: flex; flex-direction: column; padding: 40px 20px; height: 100vh; float: left; border-right: 1px solid #1e293b; }
        .nav-link { padding: 18px; margin-bottom: 10px; border-radius: 12px; cursor: pointer; color: #64748b; font-weight: 700; }
        .nav-link.active { background: var(--goblocks-red); color: white; }
        .viewport { margin-left: 280px; padding: 60px; height: 100vh; overflow-y: auto; }
        
        /* Marketplace & Home Layout */
        .grid { display: grid; grid-template-columns: repeat(auto-fill, minmax(200px, 1fr)); gap: 20px; margin-top: 20px; }
        .card { background: var(--card-bg); padding: 20px; border-radius: 15px; border: 1px solid #334155; text-align: center; }
        .btn { width: 100%; padding: 12px; background: var(--goblocks-red); color: white; border: none; border-radius: 8px; font-weight: 900; cursor: pointer; margin-top: 10px; }
        #auth-gate { position: fixed; inset: 0; background: #0b0f1a; z-index: 10000; display: flex; align-items: center; justify-content: center; }
    </style>
</head>
<body>

    <div id="top-hud">
        <div class="stat-pill">
            <div style="width:20px; height:20px; background:var(--accent-gold); border-radius:50%"></div>
            <span id="global-block-count">0</span>
        </div>
    </div>

    <div id="auth-gate">
        <div style="background:var(--sidebar-bg); padding:50px; border-radius:24px; width:450px;">
            <h1 style="text-align:center; margin-bottom:40px; font-weight:900;">GO<span style="color:var(--goblocks-red)">BLOCKS</span></h1>
            <input type="text" id="u" placeholder="Username" style="width:100%; padding:15px; background:#1e293b; color:white; border:none; border-radius:8px; margin-bottom:15px;">
            <input type="password" id="p" placeholder="Password" style="width:100%; padding:15px; background:#1e293b; color:white; border:none; border-radius:8px; margin-bottom:15px;">
            <button class="btn" onclick="Core.Auth.login()">LOGIN</button>
            <p onclick="Core.Auth.reg()" style="text-align:center; margin-top:15px; cursor:pointer; font-size:12px; color:#64748b;">Sign Up</p>
        </div>
    </div>

    <div id="app" style="display:none;">
        <nav class="sidebar">
            <div style="font-weight:900; font-size:24px; margin-bottom:50px;">GO<span style="color:var(--goblocks-red)">B.</span></div>
            <div class="nav-link active" onclick="Core.Router.go('home', this)">Home</div>
            <div class="nav-link" onclick="Core.Router.go('market', this)">Market Place</div>
            <div class="nav-link" onclick="Core.Router.go('mining', this)">Block Mining</div>
            <div class="nav-link" onclick="Core.Router.go('players', this)">New Players</div>
            <div style="margin-top:auto; color:#ef4444; font-weight:900; cursor:pointer;" onclick="location.reload()">LOGOUT</div>
        </nav>
        <main class="viewport" id="view"></main>
    </div>

    <script>
        const Core = (() => {
            const _S = { user: null, db: () => JSON.parse(localStorage.getItem('gb_v5') || '[]') };
            const _save = (d) => localStorage.setItem('gb_v5', JSON.stringify(d));

            return {
                Auth: {
                    reg: () => {
                        const u = document.getElementById('u').value, p = document.getElementById('p').value;
                        const d = _S.db(); if(d.find(x=>x.u===u)) return alert("Taken");
                        d.push({u, p, b: 0, color: '#fbbf24', ts: Date.now()}); _save(d); alert("Done!");
                    },
                    login: () => {
                        const u = document.getElementById('u').value, p = document.getElementById('p').value;
                        const user = _S.db().find(x=>x.u===u && x.p===p);
                        if(user) { _S.user = user; document.getElementById('auth-gate').style.display='none'; document.getElementById('app').style.display='block'; document.getElementById('top-hud').style.display='block'; Core.UI.up(); Core.Router.go('home'); }
                        else alert("Error");
                    }
                },
                Router: {
                    go: (p, el) => {
                        const v = document.getElementById('view');
                        if(el) { document.querySelectorAll('.nav-link').forEach(n=>n.classList.remove('active')); el.classList.add('active'); }
                        
                        if(p === 'home') {
                            v.innerHTML = `<h1>Dashboard</h1><div style="display:flex; gap:40px; align-items:center;">${Core.UI.draw3D(_S.user)}<div class="card"><h3>Welcome, ${_S.user.u}</h3><p>Blocks: ${_S.user.b}</p></div></div>`;
                        } else if(p === 'market') {
                            v.innerHTML = `<h1>Market Place</h1><div class="grid">
                                <div class="card"><h4>Sparkle Fedora</h4><p>500 Blocks</p><button class="btn">BUY</button></div>
                                <div class="card"><h4>Red Valkyrie</h4><p>1200 Blocks</p><button class="btn">BUY</button></div>
                                <div class="card"><h4>Speed Coil</h4><p>250 Blocks</p><button class="btn">BUY</button></div>
                            </div>`;
                        } else if(p === 'mining') {
                            v.innerHTML = `<div style="text-align:center; padding-top:100px;"><h1>Refinery</h1><br><button onclick="Core.Mech.mine()" style="width:200px; height:200px; border-radius:50%; background:var(--goblocks-red); color:white; font-size:30px; font-weight:900; border:10px solid #fff; cursor:pointer;">MINE</button></div>`;
                        } else if(p === 'players') {
                            v.innerHTML = `<h1>User Logs</h1>` + _S.db().reverse().map(u=>`<div class="card" style="margin-top:10px; display:flex; justify-content:space-between;"><b>${u.u}</b> <span>${u.b} Blocks</span></div>`).join('');
                        }
                    }
                },
                Mech: {
                    mine: () => { _S.user.b++; Core.UI.up(); const d=_S.db(); const i=d.findIndex(x=>x.u===_S.user.u); d[i]=_S.user; _save(d); }
                },
                UI: {
                    up: () => { document.getElementById('global-block-count').innerText = _S.user.b; },
                    draw3D: (u) => `<div class="stage-3d" style="--char-color:${u.color}">
                        <div class="cube head"><div class="fedora"><div class="fedora-brim"></div><div class="fedora-top"></div></div></div>
                        <div class="cube torso"></div><div class="cube arm arm-l"></div><div class="cube arm arm-r"></div><div class="cube leg leg-l"></div><div class="cube leg leg-r"></div>
                    </div>`
                }
            };
        })();
    </script>
</body>
</html>
