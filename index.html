<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>GOblocks | Imagination Scripted</title>
    <link href="https://fonts.googleapis.com" rel="stylesheet">
    <style>
        :root {
            --goblocks-red: #e11d48;
            --dark-bg: #111827;
            --sidebar-bg: #1f2937;
            --text-main: #f3f4f6;
            --accent: #3b82f6;
        }

        * { margin: 0; padding: 0; box-sizing: border-box; font-family: 'Montserrat', sans-serif; }

        body { background: var(--dark-bg); color: var(--text-main); overflow: hidden; height: 100vh; }

        /* Auth Overlay */
        #auth-gate {
            position: fixed; inset: 0; background: rgba(0,0,0,0.9); z-index: 9999;
            display: flex; align-items: center; justify-content: center;
        }

        .auth-card {
            background: var(--sidebar-bg); padding: 3rem; border-radius: 12px;
            width: 400px; box-shadow: 0 25px 50px -12px rgba(0,0,0,0.5); border: 1px solid #374151;
        }

        .input-group { margin-bottom: 1.5rem; }
        input { 
            width: 100%; padding: 12px; border-radius: 6px; border: 1px solid #4b5563; 
            background: #111827; color: white; margin-top: 5px;
        }

        button {
            width: 100%; padding: 12px; border-radius: 6px; border: none;
            background: var(--goblocks-red); color: white; font-weight: bold; cursor: pointer;
            transition: transform 0.2s;
        }

        button:hover { transform: scale(1.02); }

        /* Main Layout */
        .app-container { display: flex; height: 100vh; visibility: hidden; }

        nav.sidebar {
            width: 260px; background: var(--sidebar-bg); border-right: 1px solid #374151;
            display: flex; flex-direction: column; padding: 20px;
        }

        .logo { font-weight: 900; font-size: 24px; color: var(--goblocks-red); margin-bottom: 40px; }

        .nav-item {
            padding: 15px; margin-bottom: 10px; border-radius: 8px; cursor: pointer;
            transition: 0.3s; font-weight: 600;
        }

        .nav-item:hover { background: #374151; }
        .nav-item.active { background: var(--accent); }

        .main-view { flex: 1; padding: 40px; overflow-y: auto; }

        .logout-btn {
            margin-top: auto; color: #9ca3af; font-size: 0.9rem; cursor: pointer;
            padding: 10px; border-top: 1px solid #374151;
        }

        /* Mining Mechanics */
        .mining-area { text-align: center; padding: 50px; border: 2px dashed #4b5563; border-radius: 20px; }
        .currency-count { font-size: 3rem; font-weight: 900; color: #fbbf24; margin: 20px 0; }

        /* Player List */
        .player-card {
            background: #374151; padding: 15px; border-radius: 10px; margin-bottom: 10px;
            display: flex; align-items: center; justify-content: space-between;
        }
    </style>
</head>
<body>

    <!-- Authentication Logic Gate -->
    <div id="auth-gate">
        <div class="auth-card" id="auth-ui">
            <h1 style="text-align:center; margin-bottom: 20px;">GOblocks</h1>
            <div class="input-group">
                <label>Username</label>
                <input type="text" id="username" placeholder="Enter username...">
            </div>
            <div class="input-group">
                <label>Password</label>
                <input type="password" id="password" placeholder="••••••••">
            </div>
            <button onclick="SystemEngine.auth.handleSignUp()">Sign Up</button>
            <button onclick="SystemEngine.auth.handleLogin()" style="background: transparent; margin-top: 10px;">Login</button>
        </div>
    </div>

    <!-- Interface -->
    <div class="app-container" id="app">
        <nav class="sidebar">
            <div class="logo">GOblocks</div>
            <div class="nav-item active" onclick="SystemEngine.router.navigate('home')">Home</div>
            <div class="nav-item" onclick="SystemEngine.router.navigate('marketplace')">Market Place</div>
            <div class="nav-item" onclick="SystemEngine.router.navigate('mining')">Block Mining</div>
            <div class="nav-item" onclick="SystemEngine.router.navigate('players')">New Players</div>
            
            <div class="logout-btn" onclick="SystemEngine.auth.logout()">Logout @ <span id="current-user-tag"></span></div>
        </nav>

        <main class="main-view" id="viewport">
            <!-- Dynamic Content Injected Here -->
        </main>
    </div>

    <script>
        /**
         * GOblocks COMPLEX SYSTEM CORE
         * Architecture: Singleton Engine with Encapsulated Modules
         */
        const SystemEngine = (() => {
            // Private "Database" stored in LocalStorage
            const _DB = {
                getUsers: () => JSON.parse(localStorage.getItem('gb_users') || '[]'),
                saveUser: (user) => {
                    const users = _DB.getUsers();
                    users.push(user);
                    localStorage.setItem('gb_users', JSON.stringify(users));
                }
            };

            let currentUser = null;

            return {
                auth: {
                    handleSignUp: () => {
                        const u = document.getElementById('username').value;
                        const p = document.getElementById('password').value;
                        if(u.length < 3 || p.length < 4) return alert("Too short!");
                        
                        if(_DB.getUsers().find(x => x.username === u)) return alert("User exists!");

                        const newUser = { username: u, password: p, balance: 0, joined: new Date().toISOString() };
                        _DB.saveUser(newUser);
                        alert("Account created! Now login.");
                    },
                    handleLogin: () => {
                        const u = document.getElementById('username').value;
                        const p = document.getElementById('password').value;
                        const user = _DB.getUsers().find(x => x.username === u && x.password === p);

                        if(user) {
                            currentUser = user;
                            document.getElementById('auth-gate').style.display = 'none';
                            document.getElementById('app').style.visibility = 'visible';
                            document.getElementById('current-user-tag').innerText = u;
                            SystemEngine.router.navigate('home');
                        } else {
                            alert("Invalid credentials.");
                        }
                    },
                    logout: () => { location.reload(); }
                },

                router: {
                    navigate: (page) => {
                        const vp = document.getElementById('viewport');
                        const navItems = document.querySelectorAll('.nav-item');
                        navItems.forEach(i => i.classList.remove('active'));

                        const content = {
                            home: `<h1>Welcome, ${currentUser?.username}</h1><p>Select a module from the sidebar to begin.</p>`,
                            marketplace: `<h1>Market Place</h1><div style="display:grid; grid-template-columns: 1fr 1fr; gap: 20px; margin-top:20px;">
                                <div class="player-card"><span>Golden Block Skin</span><button style="width:80px">50 B</button></div>
                                <div class="player-card"><span>Speed Coil</span><button style="width:80px">150 B</button></div>
                            </div>`,
                            mining: `<h1>Block Mining</h1>
                                <div class="mining-area">
                                    <p>Click to generate Block Currency</p>
                                    <div class="currency-count" id="b-count">${currentUser.balance}</div>
                                    <button onclick="SystemEngine.mechanics.mine()" style="width:200px">MINE!</button>
                                </div>`,
                            players: `<h1>New Players</h1><div id="player-list" style="margin-top:20px"></div>`
                        };

                        vp.innerHTML = content[page];
                        if(page === 'players') SystemEngine.mechanics.renderPlayers();
                    }
                },

                mechanics: {
                    mine: () => {
                        currentUser.balance += 1;
                        document.getElementById('b-count').innerText = currentUser.balance;
                        // Sync with DB
                        const users = _DB.getUsers();
                        const idx = users.findIndex(u => u.username === currentUser.username);
                        users[idx].balance = currentUser.balance;
                        localStorage.setItem('gb_users', JSON.stringify(users));
                    },
                    renderPlayers: () => {
                        const list = document.getElementById('player-list');
                        const users = _DB.getUsers().reverse(); // Newest first
                        list.innerHTML = users.map(u => `
                            <div class="player-card">
                                <span><strong>${u.username}</strong></span>
                                <span style="font-size: 0.8rem; color: #9ca3af;">Joined: ${new Date(u.joined).toLocaleDateString()}</span>
                            </div>
                        `).join('');
                    }
                }
            };
        })();
    </script>
</body>
</html>
