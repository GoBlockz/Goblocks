<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>GOblocks | Engine 2.1</title>
    <link href="https://fonts.googleapis.com" rel="stylesheet">
    <style>
        :root {
            --goblocks-red: #e11d48; --dark-bg: #0f172a; --sidebar-bg: #1e293b;
            --card-bg: #334155; --text-main: #f8fafc; --accent-gold: #fbbf24;
        }
        * { margin: 0; padding: 0; box-sizing: border-box; font-family: 'Montserrat', sans-serif; }
        body { background: var(--dark-bg); color: var(--text-main); overflow: hidden; height: 100vh; }

        /* --- TOP HUD (BLOCK COUNT) --- */
        #top-hud { position: fixed; top: 25px; right: 25px; z-index: 99999; display: none; }
        .stat-pill {
            background: rgba(15, 23, 42, 0.9); backdrop-filter: blur(15px);
            padding: 12px 25px; border-radius: 8px; border: 2px solid var(--accent-gold);
            display: flex; align-items: center; gap: 12px;
        }
        .currency-icon { width: 22px; height: 22px; background: var(--accent-gold); border-radius: 4px; }

        /* --- AVATAR & ACCESSORY SYSTEM --- */
        .avatar-preview { width: 180px; height: 240px; margin: 20px auto; position: relative; display: flex; flex-direction: column; align-items: center; }
        .av-part { border: 2px solid rgba(0,0,0,0.2); transition: 0.3s; }
        .av-head { width: 55px; height: 55px; border-radius: 10px; position: relative; z-index: 2; }
        .av-torso { width: 100px; height: 110px; border-radius: 6px; z-index: 1; }
        .av-legs { display: flex; gap: 12px; margin-top: 5px; }
        .av-leg { width: 40px; height: 65px; border-radius: 4px; }
        
        /* Accessories */
        .acc-hat { position: absolute; top: -15px; left: 50%; transform: translateX(-50%); width: 70px; height: 25px; background: #333; border-radius: 20px 20px 0 0; z-index: 3; display: none; }
        .acc-hair { position: absolute; top: -5px; left: 50%; transform: translateX(-50%); width: 60px; height: 30px; background: #5d4037; border-radius: 15px; z-index: 3; display: none; }
        
        /* --- LAYOUT --- */
        .app-shell { display: none; height: 100vh; width: 100vw; }
        #auth-gate { position: fixed; inset: 0; background: #0f172a; z-index: 100000; display: flex; align-items: center; justify-content: center; }
        .auth-card { background: var(--sidebar-bg); padding: 40px; border-radius: 16px; width: 400px; border: 1px solid #334155; }
        input { width: 100%; padding: 14px; border-radius: 8px; border: 2px solid #334155; background: #0f172a; color: white; margin-bottom: 15px; outline: none; }
        .btn-primary { width: 100%; padding: 14px; background: var(--goblocks-red); color: white; border: none; border-radius: 8px; font-weight: 900; cursor: pointer; }
        
        nav.sidebar { width: 280px; background: var(--sidebar-bg); display: flex; flex-direction: column; padding: 30px 15px; border-right: 1px solid #334155; }
        .nav-link { padding: 16px 20px; margin-bottom: 8px; border-radius: 12px; cursor: pointer; font-weight: 700; color: #94a3b8; transition: 0.2s; }
        .nav-link.active { background: var(--goblocks-red); color: white; }
        .logout-section { margin-top: auto; color: #ef4444; font-weight: 700; cursor: pointer; padding: 20px; border-top: 1px solid #334155; }
        .viewport { flex: 1; padding: 60px; overflow-y: auto; }

        .editor-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 40px; }
        .control-panel { background: var(--sidebar-bg); padding: 25px; border-radius: 15px; }
        .item-slot { background: var(--card-bg); padding: 15px; border-radius: 10px; margin-bottom: 10px; cursor: pointer; text-align: center; font-weight: bold; border: 2px solid transparent; }
        .item-slot:hover { border-color: var(--goblocks-red); }
        .color-dot { width: 35px; height: 35px; border-radius: 50%; cursor: pointer; display: inline-block; margin: 5px; border: 2px solid rgba(0,0,0,0.3); }
    </style>
</head>
<body>

    <div id="top-hud">
        <div class="stat-pill">
            <div class="currency-icon"></div>
            <span id="global-block-count">0</span>
        </div>
    </div>

    <div id="auth-gate">
        <div class="auth-card">
            <h1 style="text-align:center; margin-bottom: 30px; color:var(--goblocks-red); font-weight:900;">GOblocks</h1>
            <input type="text" id="u-input" placeholder="Username">
            <input type="password" id="p-input" placeholder="Password">
            <button class="btn-primary" onclick="Core.Auth.login()">Enter Engine</button>
            <p onclick="Core.Auth.register()" style="text-align:center; margin-top:15px; cursor:pointer; font-size:12px; color:#94a3b8;">Create New Account</p>
        </div>
    </div>

    <div class="app-shell" id="main-engine">
        <nav class="sidebar">
            <div style="font-weight:900; font-size: 24px; margin-bottom: 40px; text-align:center;">GO<span style="color:var(--goblocks-red)">BLOCKS</span></div>
            <div class="nav-link active" onclick="Core.Router.go('home', this)">Home</div>
            <div class="nav-link" onclick="Core.Router.go('avatar', this)">Character Hub</div>
            <div class="nav-link" onclick="Core.Router.go('market', this)">Market Place</div>
            <div class="nav-link" onclick="Core.Router.go('mining', this)">Block Mining</div>
            <div class="nav-link" onclick="Core.Router.go('players', this)">New Players</div>
            <div class="logout-section" onclick="location.reload()">Logout Account</div>
        </nav>
        <main class="viewport" id="view-target"></main>
    </div>

    <script>
        const Core = (() => {
            const _STATE = { user: null, db: () => JSON.parse(localStorage.getItem('gb_v2.1') || '[]') };
            const _save = (data) => localStorage.setItem('gb_v2.1', JSON.stringify(data));

            return {
                Auth: {
                    register: () => {
                        const u = document.getElementById('u-input').value;
                        const p = document.getElementById('p-input').value;
                        const users = _STATE.db();
                        if(users.find(x => x.u === u)) return alert("User exists");
                        users.push({ u, p, b: 0, color: '#fbbf24', acc: {hat: false, hair: false}, ts: Date.now() });
                        _save(users); alert("Account created!");
                    },
                    login: () => {
                        const u = document.getElementById('u-input').value;
                        const p = document.getElementById('p-input').value;
                        const user = _STATE.db().find(x => x.u === u && x.p === p);
                        if(user) {
                            _STATE.user = user;
                            document.getElementById('auth-gate').style.display = 'none';
                            document.getElementById('main-engine').style.display = 'flex';
                            document.getElementById('top-hud').style.display = 'block';
                            Core.UI.updateHUD();
                            Core.Router.go('home');
                        } else { alert("Invalid login"); }
                    }
                },
                Router: {
                    go: (page, el) => {
                        const target = document.getElementById('view-target');
                        if(el) { document.querySelectorAll('.nav-link').forEach(n => n.classList.remove('active')); el.classList.add('active'); }
                        
                        if(page === 'avatar') {
                            target.innerHTML = `<h1>Character Hub</h1><div class="editor-grid">
                                <div id="preview-box">${Core.UI.drawAvatar(_STATE.user)}</div>
                                <div class="control-panel">
                                    <h3>Skin Tone</h3>
                                    ${['#fbbf24', '#eab308', '#d97706', '#fcd34d', '#78350f'].map(c => `<div class="color-dot" style="background:${c}" onclick="Core.Mechanics.setSkin('${c}')"></div>`).join('')}
                                    <h3 style="margin-top:20px;">Accessories</h3>
                                    <div class="item-slot" onclick="Core.Mechanics.toggleAcc('hat')">Toggle Fedora</div>
                                    <div class="item-slot" onclick="Core.Mechanics.toggleAcc('hair')">Toggle Hair</div>
                                </div>
                            </div>`;
                        } else if(page === 'home') {
                            target.innerHTML = `<h1>Welcome back, ${_STATE.user.u}</h1>${Core.UI.drawAvatar(_STATE.user)}`;
                        } else if(page === 'mining') {
                            target.innerHTML = `<div style="text-align:center; padding-top:50px;"><h1>Block Mining</h1><br><button onclick="Core.Mechanics.mine()" style="width:180px; height:180px; border-radius:50%; background:var(--goblocks-red); color:white; font-size:28px; font-weight:900; cursor:pointer;">MINE</button></div>`;
                        } else if(page === 'players') {
                            target.innerHTML = `<h1>New Players</h1><div id="p-list"></div>`; Core.Mechanics.loadPlayers();
                        } else {
                            target.innerHTML = `<h1>${page.toUpperCase()}</h1><p>Module coming soon.</p>`;
                        }
                    }
                },
                Mechanics: {
                    mine: () => { _STATE.user.b += 1; Core.UI.updateHUD(); Core.Mechanics.sync(); },
                    setSkin: (c) => { _STATE.user.color = c; Core.Mechanics.refreshPreview(); Core.Mechanics.sync(); },
                    toggleAcc: (type) => { _STATE.user.acc[type] = !_STATE.user.acc[type]; Core.Mechanics.refreshPreview(); Core.Mechanics.sync(); },
                    sync: () => { const users = _STATE.db(); const idx = users.findIndex(x => x.u === _STATE.user.u); users[idx] = _STATE.user; _save(users); },
                    refreshPreview: () => { document.getElementById('preview-box').innerHTML = Core.UI.drawAvatar(_STATE.user); },
                    loadPlayers: () => {
                        document.getElementById('p-list').innerHTML = _STATE.db().reverse().map(p => `<div style="background:var(--card-bg); padding:15px; margin-top:10px; border-radius:8px;"><b>${p.u}</b> - ${p.b} Blocks</div>`).join('');
                    }
                },
                UI: {
                    updateHUD: () => { document.getElementById('global-block-count').innerText = _STATE.user.b; },
                    drawAvatar: (u) => `
                        <div class="avatar-preview">
                            <div class="acc-hat" style="display:${u.acc.hat?'block':'none'}"></div>
                            <div class="acc-hair" style="display:${u.acc.hair?'block':'none'}"></div>
                            <div class="av-head av-part" style="background:${u.color}"></div>
                            <div class="av-torso av-part" style="background:${u.color}"></div>
                            <div class="av-legs">
                                <div class="av-leg av-part" style="background:${u.color}"></div>
                                <div class="av-leg av-part" style="background:${u.color}"></div>
                            </div>
                        </div>`
                }
            };
        })();
    </script>
</body>
</html>
